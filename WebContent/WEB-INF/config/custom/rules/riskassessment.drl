package RISKASSESSMENT_RuleSet
expander riskassessment.dsl

import com.idsscheer.webapps.arcm.bl.re.ext.CollectiveHelper;
import com.idsscheer.webapps.arcm.bl.component.riskmanagement.re.RiskassessmentHelper;
import com.idsscheer.webapps.arcm.bl.component.riskmanagement.re.RiskassessmentHelperBB;

# OBJECT         client_objid          LONG       Client ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# OBJECT         client_sign           CLIENTSIGN Client                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
# OBJECT         create_date           DATE       Creation date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# OBJECT         creator_user_id       LONG       User ID (creator)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# OBJECT         delete_date           DATE       Deletion date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# OBJECT         guid                  STRING     GUID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# OBJECT         obj_id                LONG       ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# OBJECT         obj_type              OBJECTTYPE Object type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# OBJECT         root_guid             STRING     Root GUID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# OBJECT         versions              LONG       Number of versions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# VERSION        aris_change_date      DATE       ARIS change date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# VERSION        change_date           DATE       Change date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# VERSION        change_type           ENUM       Change type                           changetype (created=0,unchanged=1,changed=2,deleted=3,xmlcreated=4,xmlchanged=5,xmldeleted=6)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
# VERSION        change_user_id        LONG       User ID (editor)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# VERSION        deactivated           BOOLEAN    Deactivated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# VERSION        id                    LONG       ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# VERSION        substitute_user_id    LONG       User ID (substitute)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# VERSION        version_active        BOOLEAN    Current version                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# VERSION        version_number        LONG       Version number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL  execution_date        DATE       Assessment date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# TRANSACTIONAL  owner                 LIST       Performed by                          to 1 USER (LT=3169)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL  owner_group           LIST       Risk owner group                      to 1 USERGROUP (LT=3168)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL  owner_status          ENUM       Owner status                          assessment_state (all=-1,open=0,closed=-3,new=1,in_progress=2,to_be_reviewed=-2,assessed=3,assessment_not_possible=4,not_assessed=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
# TRANSACTIONAL  owner_substitute      LIST       Performed by (substitute)             to 1 USER (LT=3175)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL  review_date           DATE       Review date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# TRANSACTIONAL  reviewer              LIST       Reviewed by                           to 1 USER (LT=4024)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL  reviewer_group        LIST       Risk reviewer group                   to 1 USERGROUP (LT=3167)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL  reviewer_status       ENUM       Reviewer status                       review_state (all=-1,unspecified=0,agreed=1,disagreed=2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL  reviewer_substitute   LIST       Reviewed by (substitute)              to 1 USER (LT=4025)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# MONITORABLE    controlenddate        DATE       End of control period                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
# MONITORABLE    controlstartdate      DATE       Start of control period                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# MONITORABLE    plannedenddate        DATE       End date of risk assessment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# MONITORABLE    plannedstartdate      DATE       Start date of risk assessment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# RISKASSESSMENT appsystem             LIST       Application system type               to * HIERARCHYs (LT=3172)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT assessment_activities TEXT       Assessment activities                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
# RISKASSESSMENT avg_loss              DOUBLE     Average amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# RISKASSESSMENT basis_of_valuation    ENUM       Basis of assessment                   basis_of_valuation (all=-1,unspecified=0,expert=1,empiric_data=2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# RISKASSESSMENT currency              ENUM       Currency                              currency (please_select=0,MIXED=-99,common=-1,AUD=8,CAD=26,CNY=30,EUR=47,GBP=50,JPY=74,USD=155,others=-2,AED=1,AFA=2,AFN=971,ALL=3,AMD=4,ANG=5,AOA=6,ARS=7,AWG=9,AZM=10,BAM=11,BBD=12,BDT=13,BGN=14,BHD=15,BIF=16,BMD=17,BND=18,BOB=19,BRL=20,BSD=21,BTN=22,BWP=23,BYR=24,BZD=25,CDF=27,CHF=28,CLP=29,COP=31,CRC=32,CSD=33,CUC=34,CUP=35,CVE=36,CYP=37,CZK=38,DJF=39,DKK=40,DOP=41,DZD=42,EEK=43,EGP=44,ERN=45,ETB=46,FJD=48,FKP=49,GEL=51,GGP=52,GHC=53,GIP=54,GMD=55,GNF=56,GTQ=57,GYD=58,HKD=59,HNL=60,HRK=61,HTG=62,HUF=63,IDR=64,ILS=65,IMP=66,INR=67,IQD=68,IRR=69,ISK=70,JEP=71,JMD=72,JOD=73,KES=75,KGS=76,KHR=77,KMF=78,KPW=79,KRW=80,KWD=81,KYD=82,KZT=83,LAK=84,LBP=85,LKR=86,LRD=87,LSL=88,LTL=89,LVL=90,LYD=91,MAD=92,MDL=93,MGA=94,MKD=95,MMK=96,MNT=97,MOP=98,MRO=99,MTL=100,MUR=101,MVR=102,MWK=103,MXN=104,MYR=105,MZM=106,MZN=943,NAD=107,NGN=108,NIO=109,NOK=110,NPR=111,NZD=112,OMR=113,PAB=114,PEN=115,PGK=116,PHP=117,PKR=118,PLN=119,PYG=120,QAR=121,ROL=122,RON=946,RSD=941,RUB=123,RWF=124,SAR=125,SBD=126,SCR=127,SDD=128,SDG=938,SEK=129,SGD=130,SHP=131,SIT=132,SKK=133,SLL=134,SOS=135,SPL=136,SRD=137,STD=138,SVC=139,SYP=140,SZL=141,THB=142,TJS=143,TMM=144,TND=145,TOP=146,TRL=147,TRY=148,TTD=149,TVD=150,TWD=151,TZS=152,UAH=153,UGX=154,UYU=156,UZS=157,VEB=158,VEF=937,VND=159,VUV=160,WST=161,XAF=162,XAG=163,XAU=164,XCD=165,XDR=166,XOF=167,XPD=168,XPF=169,XPT=170,YER=171,ZAR=172,ZMK=173,ZWD=174)
# RISKASSESSMENT data_source           ENUM       Data source                           data_source (all=-1,unspecified=0,internal=1,external=2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# RISKASSESSMENT documents             LIST       Documents                             to * DOCUMENTs (LT=3174)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# RISKASSESSMENT exp_avg_loss          DOUBLE     Expected loss (average)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# RISKASSESSMENT exp_max_loss          DOUBLE     Expected loss (maximum)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# RISKASSESSMENT exp_min_loss          DOUBLE     Expected loss (minimum)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# RISKASSESSMENT finaccount            LIST       Regulations                           to * HIERARCHYs (LT=3173)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT frequ_avg_loss        DOUBLE     Average occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
# RISKASSESSMENT frequ_loss_qual       ENUM       Occurrence frequency                  frequency_loss_qualitative (all=-1,unspecified=0,very_low=1,low=2,average=3,high=4,very_high=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
# RISKASSESSMENT frequ_max_loss        DOUBLE     Maximum occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
# RISKASSESSMENT frequ_min_loss        DOUBLE     Minimum occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
# RISKASSESSMENT impacttypes           LIST       Impact types                          to * RA_IMPACTTYPEs (LT=5822)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
# RISKASSESSMENT initial_assessment    BOOLEAN    Automatic risk assessment upon import                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
# RISKASSESSMENT loss_qual             ENUM       Amount of damages                     loss_qualitative (all=-1,unspecified=0,unimportant=1,low=2,average=3,high=4,catastrophic=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# RISKASSESSMENT max_loss              DOUBLE     Maximum amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# RISKASSESSMENT min_loss              DOUBLE     Minimum amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# RISKASSESSMENT newLossesAvailable    BOOLEAN    Further losses occurred                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
# RISKASSESSMENT orgunit               LIST       Organizational unit                   to * HIERARCHYs (LT=3171)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT process               LIST       Function                              to 1 HIERARCHY (LT=3165)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# RISKASSESSMENT red_avg_loss          DOUBLE     Reduced average amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# RISKASSESSMENT red_exp_avg_loss      DOUBLE     Reduced expected loss (average)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT red_exp_max_loss      DOUBLE     Reduced expected loss (maximum)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT red_exp_min_loss      DOUBLE     Reduced expected loss (minimum)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT red_frequ_avg_loss    DOUBLE     Reduced average occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# RISKASSESSMENT red_frequ_loss_qual   ENUM       Reduced occurrence frequency          frequency_loss_qualitative (all=-1,unspecified=0,very_low=1,low=2,average=3,high=4,very_high=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
# RISKASSESSMENT red_frequ_max_loss    DOUBLE     Reduced maximum occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# RISKASSESSMENT red_frequ_min_loss    DOUBLE     Reduced minimum occurrence frequency                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# RISKASSESSMENT red_loss_qual         ENUM       Reduced amount of damages             loss_qualitative (all=-1,unspecified=0,unimportant=1,low=2,average=3,high=4,catastrophic=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# RISKASSESSMENT red_max_loss          DOUBLE     Reduced maximum amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# RISKASSESSMENT red_min_loss          DOUBLE     Reduced minimum amount of damages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# RISKASSESSMENT remark                TEXT       Remark                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
# RISKASSESSMENT risk                  LIST       Risk                                  to 1 RISK (LT=3166)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# RISKASSESSMENT risk_category         LIST       Risk category                         to * HIERARCHYs (LT=3170)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# RISKASSESSMENT type                  ENUM       Assessment type                       assessment_type (all=-1,please_select=0,both=1,quantitative=2,qualitative=3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                

# DO NOT CHANGE THE LINES ABOVE - all of them will be updated automatically by tool com.idsscheer.webapps.arcm.bl.re.RETemplater

################################################
### All workflow states - before state rules ###

rule "plannedstartdate allowed before today[I,V]"

    salience 10400

	when
		value comparison fulfilled: ":transient:" attr_value "plannedstartdate" "GREATER THAN" value ":TODAY:"
	then
        set "plannedstartdate"   invalid
		add "error" message "start.date.not.after.today.ERR" to "plannedstartdate"
end

rule "duration riskassessment after today allowed[I,V]"

    salience 10500

	when
		value comparison fulfilled: ":transient:" attr_value "plannedenddate" "LESS THAN" value ":TODAY:"
	then
        set "plannedstartdate"   invalid
		add "error" message "erro.date.duration.riskassessment.DBI" to "plannedstartdate"
end

#
# if the assessment has at least one assessment impact with type 'quantitative' then we need a filled currency
# (is done at risk assessment form and copied automatically from there to the assessment impact types)
#
rule "if at least one assessment impact type is quantitative then currency is mandatory [I,V]"

    salience 10300

	when
	    at least one impact type has type quantitative

	then
        set "currency" mandatory

end

#
# if the assessment has at least one assessment impact with type 'quantitative' then we need a filled currency
# (is done at risk assessment form and copied automatically from there to the assessment impact types)
#
rule "if at least one assessment impact type is quantitative then check if currency is set [I,V]"

    salience 10200

	when
	    "currency"       is_not filled
	    at least one impact type has type quantitative

	then
        set "currency" invalid
        add "error" message "assessment.quantitative.impact.type.needs.currency.ERR" to "currency"

end

#
# The assessment period must be welldefined (plannedstartdate <= plannedenddate)
#
rule "assessment period: plannedstartdate > plannedenddate [V]"

	salience 10100

	when
		attribute comparison fulfilled: ":transient:" attr_value "plannedstartdate" "GREATER THAN" ":transient:" attr_value "plannedenddate"

	then
		set "plannedenddate" invalid
		add "error" message "error.date.range.DBI" to "plannedenddate"

end

#
# The assessment period cannot be shortened.
#
rule "assessment period cannot be shortened [V]"

	salience 10000

	when
	    attribute comparison fulfilled: ":transient:" attr_value "plannedenddate" "LESS THAN" ":persistent:" attr_value "plannedenddate"

	then
		set "plannedenddate" invalid
		add "error" message "assessment.period.extend.only.ERR" to "plannedenddate"

end


##########################################
### Workflow state "openForExecution"  ###

# plannedenddate can be edited if the risk assessment is open for execution.
# In standard configuration only the system administrator, client administrator and risk manager can do this.
rule "plannedenddate editable (general) [I,V]"

	salience 2700

	when
		is in workflow state "openForExecution"
		user has right "extend"

	then
		set "plannedenddate" editable
		set "plannedenddate" mandatory

end

rule "risk owner - editable fields [I,V]"

	salience 2600

	when
		is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"

	then
		set "owner_status"      	editable
		set "documents"             editable
		set "impacttypes"           editable
		
		########################
		### BB CUSTOMIZATION ###
		set "data_source"           readonly 
		set "basis_of_valuation"    invisible
		set "bb_owner_analysis"     editable
		set "remark"                readonly 

end

rule "risk owner - define 'owner_status' mandatory [I,V]"

	salience 2500

	when
	    is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"

	then
		set "owner_status" mandatory

end

rule "risk owner - define editable fields for quantitative assessments [I,V]"

	salience 2400

	when
		is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"

	then
		set "currency"              editable

end

rule "risk owner - set new losses available message [I,V]"

	salience 2300

	when
		is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"
		value comparison fulfilled: ":transient:" attr_value "newLossesAvailable" "EQUALS" value "true"

	then
	    add object "information" message "info.riskassessment.new.losses.available.INF"

end

#
# If the assessment status is set to 'Assessed' then at least one risk assessment impact type must be filled
#
rule "owner_status=assessed --> at least one assessed impact type is required [I,V]"

	salience 2200

	when
	    is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"
		value comparison fulfilled: ":transient:" attr_value "owner_status" "CONTAINS" value "assessed"
        no risk assessment impact type assessed

	then
		set "owner_status" invalid
		set "impacttypes" invalid
        add "information" message "assessment.needs.at.least.one.filled.impact.type.INF" to "owner_status"
        add "information" message "assessment.needs.at.least.one.filled.impact.type.INF" to "impacttypes"

end

#
# If the assessment status is set to 'Assessment not possible' no attribute should be
# mandatory except for the attribute Remark.
#
rule "owner_status=assessment_not_possible --> define mandatory fields [I,V]"

	salience 2100

	when
	    is in workflow state "openForExecution"
		user is ":persistent:" member of group in list "owner_group"
		( value comparison fulfilled: ":transient:" attr_value "owner_status" "CONTAINS" value "assessment_not_possible" ) OR
		( value comparison fulfilled: ":transient:" attr_value "owner_status" "CONTAINS" value "assessed" )

	then
		#set "remark"       mandatory
		########################
		### BB CUSTOMIZATION ###
		set "bb_owner_analysis" mandatory

end

rule "risk assessment not in test period -> define all standard attributes readonly [I,V]"

	salience 2000

	when
	    is in workflow state "openForExecution"
	    user is ":persistent:" member of group in list "owner_group"
	    ( "plannedstartdate" is filled AND value comparison fulfilled: ":transient:" attr_value "plannedstartdate" "GREATER THAN" value ":TODAY:") OR
        ( "plannedenddate" is filled AND value comparison fulfilled: ":transient:" attr_value "plannedenddate" "LESS THAN" value ":TODAY:")

	then
		set "basis_of_valuation"    readonly
		set "data_source"           readonly
		set "owner_status"      	readonly
		set "documents"             readonly
		set "remark"                readonly
		set "impacttypes"           readonly
	    set "currency"              readonly

		set "plannedenddate"        not_mandatory
		set "owner_status"          not_mandatory
		set "remark"                not_mandatory

		add object "error" message "message.risk.assessment.period.not.active.ERR"

end



#######################################
### Workflow state "openForReview"  ###

rule "risk reviewer: editable fields [I,V,AC]"

	salience 1200

	when
		is in workflow state "openForReview"
		user is ":persistent:" member of group in list "reviewer_group"

	then
		set "reviewer_status" editable
		
		########################
		### BB CUSTOMIZATION ###
		set "remark"                editable
		set "documents"             editable
end

########################
### BB CUSTOMIZATION ###

rule "define remark attribute mandatory if reviewer_status=disagreed[I,V]"

   salience 1200
   no-loop true
   
	when
	    is in workflow state "openForReview"
		user is ":persistent:" member of group in list "reviewer_group"
		value comparison fulfilled: ":transient:" attr_value "reviewer_status" "CONTAINS" value "disagreed"

	then
		set "remark"       mandatory

end
 
#
# general mandatory fields for risk reviewer
#
rule "risk reviewer - define mandatory fields [I,V]"

	salience 1100

	when
	    is in workflow state "openForReview"
		user is ":persistent:" member of group in list "reviewer_group"

	then
		set "reviewer_status" editable
		set "reviewer_status" mandatory

end

#
# If the reviewer disagrees to this assessment he also should be able to edit the plannedenddate.
#
rule "plannedenddate editable (reviewer disagreed) [V]"

	salience 1000

	when
	    is in workflow state "openForReview"
	    user has right "extend"
		user is ":persistent:" member of group in list "reviewer_group"
		value comparison fulfilled: ":transient:" attr_value "reviewer_status" "CONTAINS" value "disagreed"

	then
		set "plannedenddate" editable
		set "plannedenddate" mandatory

end


rule "define some attributes as editable [I,V]"

    salience 900
    no-loop true

	when

	then
		set "type"					   readonly
end

rule "hide owner upload if empty [I,V]"

    salience 90
    no-loop true

    when
        "owner_upload_user" is_not filled

    then
        set "owner_upload_user" invisible
        set "owner_upload_confirm" invisible

end


rule "hide reviewer upload if empty [I,V]"

    salience 80
    no-loop true

    when
        "reviewer_upload_user" is_not filled

    then
        set "reviewer_upload_user" invisible
        set "reviewer_upload_confirm" invisible

end
