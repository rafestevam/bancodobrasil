package INCIDENT_RuleSet
expander incident.dsl

import com.idsscheer.webapps.arcm.bl.re.ext.CollectiveHelper;
import com.idsscheer.webapps.arcm.bl.component.lossmanagement.re.IncidentHelper;

# OBJECT        client_objid               LONG       Client ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# OBJECT        client_sign                CLIENTSIGN Client                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
# OBJECT        create_date                DATE       Creation date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# OBJECT        creator_user_id            LONG       User ID (creator)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# OBJECT        delete_date                DATE       Deletion date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# OBJECT        guid                       STRING     GUID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# OBJECT        obj_id                     LONG       ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# OBJECT        obj_type                   OBJECTTYPE Object type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# OBJECT        root_guid                  STRING     Root GUID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# OBJECT        versions                   LONG       Number of versions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# VERSION       aris_change_date           DATE       ARIS change date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# VERSION       change_date                DATE       Change date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# VERSION       change_type                ENUM       Change type                           changetype (created=0,unchanged=1,changed=2,deleted=3,xmlcreated=4,xmlchanged=5,xmldeleted=6)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
# VERSION       change_user_id             LONG       User ID (editor)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# VERSION       deactivated                BOOLEAN    Deactivated                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# VERSION       id                         LONG       ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
# VERSION       substitute_user_id         LONG       User ID (substitute)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# VERSION       version_active             BOOLEAN    Current version                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# VERSION       version_number             LONG       Version number                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL execution_date             DATE       Processed on                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
# TRANSACTIONAL owner                      LIST       Performed by                          to 1 USER (LT=3306)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL owner_group                LIST       Owner group                           to 1 USERGROUP (LT=3305)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL owner_status               ENUM       Owner status                          lossdb_incidentowner_state (all=-1,open=-2,new=1,in_progress=2,closed=3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL owner_substitute           LIST       Performed by (substitute)             to 1 USER (LT=3307)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL review_date                DATE       Review date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# TRANSACTIONAL reviewer                   LIST       Reviewer                              to 1 USER (LT=4015)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# TRANSACTIONAL reviewer_group             LIST       Reviewer group                        to 1 USERGROUP (LT=3308)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# TRANSACTIONAL reviewer_status            ENUM       Reviewer status                       lossdb_incidentreviewer_state (all=-1,unspecified=0,accepted=1,rejected=2,not_accepted=-3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
# TRANSACTIONAL reviewer_substitute        LIST       Reviewer (substitute)                 to 1 USER (LT=4016)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
# INCIDENT      appsystem                  LIST       Application system types              to * HIERARCHYs (LT=3302)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      audits                     LIST       Audits                                to * AUDITs (LT=3324)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# INCIDENT      businessLinesLevel_1       ENUM       Business line level 1                 lossdb_businessline_lvl1 (all=-1,please_select=0,corporate_finance=1,trading_and_sales=2,retail_banking=3,commercial_banking=4,payment_and_settlement=5,agency_services=6,asset_management=7,retail_brokerage=8)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
# INCIDENT      businessLinesLevel_2       ENUM       Business line level 2                 lossdb_businessline_lvl2 (all=-1,please_select=0,grp_corporate_finance=1,corporate_finance=11,government_finance=12,merchant_banking=13,advisory_sales=14,grp_trading_and_sales=2,sales=21,market_making=22,proprietary_positions=23,treasury=24,grp_retail_banking=3,retail_banking=31,private_banking=32,card_services=33,grp_commercial_banking=4,commercial_banking=41,grp_payment_and_settlement=5,external_clients=51,grp_agency_services=6,custody=61,corporate_agency=62,corporate_trust=63,grp_asset_management=7,discretionary_fund_mgmt=71,non_discretionary_fund_mgmt=72,grp_retail_brokerage=8,retail_brokerage=81)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
# INCIDENT      controls                   LIST       Controls                              to * CONTROLs (LT=3322)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# INCIDENT      currency                   ENUM       Currency                              currency (please_select=0,MIXED=-99,common=-1,AUD=8,CAD=26,CNY=30,EUR=47,GBP=50,JPY=74,USD=155,others=-2,AED=1,AFA=2,AFN=971,ALL=3,AMD=4,ANG=5,AOA=6,ARS=7,AWG=9,AZM=10,BAM=11,BBD=12,BDT=13,BGN=14,BHD=15,BIF=16,BMD=17,BND=18,BOB=19,BRL=20,BSD=21,BTN=22,BWP=23,BYR=24,BZD=25,CDF=27,CHF=28,CLP=29,COP=31,CRC=32,CSD=33,CUC=34,CUP=35,CVE=36,CYP=37,CZK=38,DJF=39,DKK=40,DOP=41,DZD=42,EEK=43,EGP=44,ERN=45,ETB=46,FJD=48,FKP=49,GEL=51,GGP=52,GHC=53,GIP=54,GMD=55,GNF=56,GTQ=57,GYD=58,HKD=59,HNL=60,HRK=61,HTG=62,HUF=63,IDR=64,ILS=65,IMP=66,INR=67,IQD=68,IRR=69,ISK=70,JEP=71,JMD=72,JOD=73,KES=75,KGS=76,KHR=77,KMF=78,KPW=79,KRW=80,KWD=81,KYD=82,KZT=83,LAK=84,LBP=85,LKR=86,LRD=87,LSL=88,LTL=89,LVL=90,LYD=91,MAD=92,MDL=93,MGA=94,MKD=95,MMK=96,MNT=97,MOP=98,MRO=99,MTL=100,MUR=101,MVR=102,MWK=103,MXN=104,MYR=105,MZM=106,MZN=943,NAD=107,NGN=108,NIO=109,NOK=110,NPR=111,NZD=112,OMR=113,PAB=114,PEN=115,PGK=116,PHP=117,PKR=118,PLN=119,PYG=120,QAR=121,ROL=122,RON=946,RSD=941,RUB=123,RWF=124,SAR=125,SBD=126,SCR=127,SDD=128,SDG=938,SEK=129,SGD=130,SHP=131,SIT=132,SKK=133,SLL=134,SOS=135,SPL=136,SRD=137,STD=138,SVC=139,SYP=140,SZL=141,THB=142,TJS=143,TMM=144,TND=145,TOP=146,TRL=147,TRY=148,TTD=149,TVD=150,TWD=151,TZS=152,UAH=153,UGX=154,UYU=156,UZS=157,VEB=158,VEF=937,VND=159,VUV=160,WST=161,XAF=162,XAG=163,XAU=164,XCD=165,XDR=166,XOF=167,XPD=168,XPF=169,XPT=170,YER=171,ZAR=172,ZMK=173,ZWD=174)
# INCIDENT      description                TEXT       Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# INCIDENT      discoveryDate              DATE       Discovery date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# INCIDENT      documents                  LIST       Documents                             to * DOCUMENTs (LT=3304)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# INCIDENT      entryDate                  DATE       Occurrence date                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      eventCauseClassificLevel_1 ENUM       Incident cause classification level 1 lossdb_eventcause_lvl1 (all=-1,please_select=0,people_risk=1,process_risk=2,relationships=3,technology=4,external=5)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
# INCIDENT      eventCauseClassificLevel_2 ENUM       Incident cause classification level 2 lossdb_eventcause_lvl2 (all=-1,please_select=0,grp_people_risk=1,employee_errors=11,human_resource_issues=12,physical_injury=13,non_physical_injury=14,wrongful_acts=15,grp_process_risk=2,business_process=21,business_risk=22,errors_and_omissions=23,specific_liabilities=24,grp_relationships=3,legal=31,negligence=32,sales_discrimination=33,sales_related_issues=34,specific_omissions=35,grp_technology=4,general_problems=41,hardware=42,security=43,software=44,systems=45,telecommunications=46,grp_external=5,disasters=51,misdeeds=52,regulations=53)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
# INCIDENT      eventTypeLevel_1           ENUM       Incident type level 1                 lossdb_eventtype_lvl1 (all=-1,please_select=0,internal_fraud=1,external_fraud=2,workplace_safety=3,business_practices=4,damage_to_physical_assets=5,system_failures=6,process_mgmt=7)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
# INCIDENT      eventTypeLevel_2           ENUM       Incident type level 2                 lossdb_eventtype_lvl2 (all=-1,please_select=0,grp_internal_fraud=1,unauthorized_activity=11,internal_theft_and_fraud=12,grp_external_fraud=2,external_theft_and_fraud=21,systems_security=22,grp_workplace_safety=3,employee_relations=31,safe_environment=32,diversity_and_discimination=33,grp_business_practices=4,disclosure=41,improper_practices=42,product_flaws=43,sponsorship=44,advisory_activities=45,grp_damage_to_physical_assets=5,disasters_and_events=51,grp_system_failures=6,systems=61,grp_process_mgmt=7,execution_and_maintenance=71,monitoring_and_reporting=72,documentation=73,account_management=74,trade_counterparties=75,vendors_and_suppliers=76)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# INCIDENT      finaccount                 LIST       Regulations                           to * HIERARCHYs (LT=3303)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      financial_aspects          BOOLEAN    Financial details                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# INCIDENT      name                       STRING     Name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
# INCIDENT      orgunit                    LIST       Organizational units                  to * HIERARCHYs (LT=3300)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      ownerRemark                TEXT       Remark (owner)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
# INCIDENT      pendingLoss                DOUBLE     Expected loss                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
# INCIDENT      policies                   LIST       Policies                              to * POLICYs (LT=3323)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
# INCIDENT      process                    LIST       Processes                             to * HIERARCHYs (LT=3301)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      reviewerRemark             TEXT       Remark (reviewer)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
# INCIDENT      risk_category              LIST       Risk category                         to * HIERARCHYs (LT=3309)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
# INCIDENT      risks                      LIST       Risks                                 to * RISKs (LT=3321)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

# DO NOT CHANGE THE LINES ABOVE - all of them will be updated automatically by tool com.idsscheer.webapps.arcm.bl.re.RETemplater

################################################
### All workflow states - before state rules ###

rule "define all standard attributes invisible [I,V]"

	salience 10200

	when

	then
		set "execution_date"             invisible

end

rule "hide financial aspects[I,V]"

	salience 10200

	when
        value comparison fulfilled: ":transient:" attr_value "financial_aspects" "EQUALS" value "false"
	then
	    set "businessLinesLevel_2" invisible
        set "eventTypeLevel_2" invisible
        set "eventCauseClassificLevel_2" invisible
        set "businessLinesLevel_1" invisible
        set "eventTypeLevel_1" invisible
        set "eventCauseClassificLevel_1" invisible
        ##set "pendingLoss" invisible
        set "currency" invisible
        
        #BdB CUSTOMIZATION
        set "bb_categEventoRisco_3" invisible
end

rule "show financial aspects[I,V]"

	salience 10200

	when
       value comparison fulfilled: ":transient:" attr_value "financial_aspects" "EQUALS" value "true"
	then
	    set "businessLinesLevel_2" visible
        set "eventTypeLevel_2" visible
        set "eventCauseClassificLevel_2" visible
        set "businessLinesLevel_1" visible
        set "eventTypeLevel_1" visible
        set "eventCauseClassificLevel_1" visible
        set "pendingLoss" visible
        set "currency" visible
        check foreign amount "pendingLoss" "currency"
        
        #BdB CUSTOMIZATION
        set "bb_categEventoRisco_3" visible
end

##################################
### Workflow states "PREPARED" ###

rule "mandatory attributes for event import job [I,V]"

	salience 4100

	when
	    is in workflow state "PREPARED"
		user is executing job with id "eventImportJob"

	then
	    set "name" editable
		set "description" editable
		set "discoveryDate" editable
		set "entryDate" editable
		set "owner_group" editable
		set "reviewer_group" editable

	    set "name" mandatory
		set "description" mandatory
		set "discoveryDate" mandatory
		set "entryDate" mandatory
		set "owner_group" mandatory
		set "reviewer_group" mandatory

end

###########################################
### Workflow states "openForExecution"  ###

#
# The Incident manager is able to change the responsible owner and reviewer groups of the
# incident as long as the incident has the status 'New' or 'In progress'. The Loss manager
# can change for the incident and the loss these groups as long as the status of the loss or
# incident is 'New' or 'In progress'.
#
rule "editable attributes for manager [I,V]"

	salience 3200

	when
		is in workflow state "openForExecution"
		( user has at object role "incidentmanager" OR
		  user has at object role "lossmanager" )

	then
		set "owner_group" editable
		set "reviewer_group" editable
		
end

rule "mandatory attributes for incident manager [I,V]"

	salience 3100

	when
		is in workflow state "openForExecution"
		user has at object role "incidentmanager"

	then
		set "owner_group" mandatory
		set "reviewer_group" mandatory

end

rule "mandatory attributes for loss manager [I,V]"

	salience 3000

	when
        is in workflow state "openForExecution"
		user has at object role "lossmanager"
	then
		set "owner_group" mandatory
		set "reviewer_group" mandatory

end

##########################################################
### Workflow states "PREPARED" and "openForExecution"  ###

rule "editable attributes for incident owner [I,V]"

	salience 2100

	when
	    # we must also check for state "PREPARED" because a new incident's form can be opened before saving 
		( is in workflow state "openForExecution" OR
		  is in workflow state "PREPARED" )
		user is ":transient:" member of group in list "owner_group"

	then
		set "name" editable
		set "description" editable
		set "discoveryDate" editable
		set "entryDate" editable
		set "businessLinesLevel_2" editable
		set "eventTypeLevel_2" editable
		set "eventCauseClassificLevel_2" editable
		set "currency" editable
		set "pendingLoss" editable
		set "orgunit" editable
		set "process" editable
		set "appsystem" editable
		set "finaccount" editable
		set "financial_aspects" editable
		set "risk_category" editable
		set "risks" editable
		set "controls" editable
		set "policies" editable
		set "audits" editable
		set "documents" editable			
		set "owner_status" editable			
		set "ownerRemark" editable
		set "reviewer_group" editable

		# BdB CUSTOMIZATIONS		
		set "bb_qtdeEventos_int" editable
		set "bb_qtdePerdasRelevantes_int" editable
		set "bb_tipoEvento" editable
		set "bb_product" editable
        set "bb_vincOperacaoCred" editable
        set "bb_sobreposRiscoMercado" editable
        set "bb_canal" editable
        set "bb_jurisdDiretoria" editable
        set "bb_categEventoRisco_3" editable
        set "bb_gestorPerda" editable
        #set "bb_URL" editable
end

rule "mandatory attributes, incident owner data [I,V]"

	salience 2000

	when
	    # we must also check for state "PREPARED" because a new incident's form can be opened before saving
		( is in workflow state "openForExecution" OR
		  is in workflow state "PREPARED" )
		user is ":transient:" member of group in list "owner_group"
	then
		set "name" mandatory
		set "description" mandatory
		set "discoveryDate" mandatory
		set "entryDate" mandatory
		set "reviewer_group" mandatory
        
        # BdB CUSTOMIZATIONS		
		set "bb_qtdeEventos_int" mandatory
		set "bb_qtdePerdasRelevantes_int" mandatory
		set "bb_tipoEvento" mandatory		
        set "bb_vincOperacaoCred" mandatory
        set "bb_sobreposRiscoMercado" mandatory
        set "bb_canal" mandatory
        set "bb_jurisdDiretoria" mandatory
        #set "bb_gestorPerda" mandatory        

end

#######################################
### Workflow state "openForReview"  ###

rule "editable attributes, incident reviewer data [I,V]"

	salience 1100

	when
		is in workflow state "openForReview"
		user is ":transient:" member of group in list "reviewer_group"

	then
		
		set "reviewer_status" editable
		set "reviewerRemark" editable
		
end

rule "mandatory attributes, incident reviewer data [I,V]"

	salience 1000

	when
	    is in workflow state "openForReview"
		user is ":transient:" member of group in list "reviewer_group"
		value comparison fulfilled: ":transient:" attr_value "reviewer_status" "CONTAINS" value "rejected"

	then
		set "reviewerRemark" mandatory
		
end

###############################################
### All workflow states - after state rules ###
